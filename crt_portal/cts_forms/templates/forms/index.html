{% extends "forms/base.html" %}

{% block page_header %}
<header class="page-header-background">
  <div class="grid-container">
    <div class="grid-row">
      <div class="grid-col-12">
        <div class="display-flex flex-column flex-align-end">
          <p><a href="/accounts/logout">log out</a></p>
        </div>
        <h1>
          CRT Complaint Records
        </h1>
      </div>
    </div>
  </div>
</header>
{% endblock %}

{% block main_class %} class="page-header-background"{% endblock %}

{% block content %}
<div class="grid-container">
  <div class="grid-col-auto">
    <a class="usa-button margin-top-2" href="/report" label="first step" name="Create record">
        + Add new record
    </a>

    <p>{{ data_dict|length }} of {{ page_format.count }} records</p>

    <nav class="usa-pagination" role="navigation" aria-label="Pagination">
      <ol class="pagination">
      <!-- first arrow button -->
      {% if page_format.has_previous %}
        <li><a href="?page={{ page_format.previous_page_number }}&per_page={{ page_format.per_page }}"aria-hidden="true">&laquo;</a></li>
      {% else %}
        <li class="disabled" aria-hidden="true">&laquo;</li>
      {% endif %}
      <!-- pagination buttons-->
      {% if page_format.show_first %}
        <li><a href="?page=1&per_page={{ page_format.per_page }}" role="button" aria-label="Page 1">1</a></li>
        <li><span class="ellipsis">...</span></li>
      {% endif %}

      {% for linkpage in page_format.page_numbers %}
        {% ifequal linkpage page_format.page %}
           <li class="is-active" aria-label="current page"><b>{{ page_format.page }}</b></li>
        {% else %}
           <li><a href="?page={{ linkpage }}&per_page={{ page_format.per_page }}" role="button" aria-label="Page {{ linkpage }}">{{ linkpage }}</a></li>
        {% endifequal %}
      {% endfor %}

      {% if page_format.show_last %}
        <li><span class="ellipsis">...</span></li>
        <a href="?page={{ page_format.total_pages }}&per_page={{ page_format.per_page }}" role="button" aria-label="Page {{ page_format.total_pages }}">{{ page_format.total_pages }}</a></span>
      {% endif %}
      <!-- last arrow button -->
      {% if page_format.has_next %}
        <li><a href="?page={{ page_format.next_page_number }}&per_page={{ page_format.per_page }}" aria-hidden="true">&raquo;</a></li>
      {% else %}
        <li class="disabled" aria-hidden="true">&raquo;</li>
      {% endif %}
      </ol>
    </nav>

  </div>
    <table class="usa-table crt-table">
      <thead>
        <tr>
          <th scope="col">Submitted</th>
          <th scope="col">Contact Name</th>
          <th scope="col">Contact Details</th>
          <th scope="col">Summary</th>
          <th scope="col">Class</th>
        </tr>
      </thead>
      {% if data_dict %}
        {% for datum in data_dict %}
          <tr>
            <td scope="row">{{ datum.report.create_date|date:"SHORT_DATE_FORMAT" }}</td>
            <td>
            {% with last=datum.report.contact_last_name|default:"—" %}
              {{ last|truncatechars:20 }}{% endwith %}, {% with first=datum.report.contact_first_name|default:"—" %}
              {{ first|truncatechars:20 }}
            {% endwith %}
            </td>
            <td>
            {% with email=datum.report.contact_email|default:"—" %}
              {{ email|truncatechars:20 }}
            {% endwith %}
            <br>
            {% with phone=datum.report.contact_phone|default:"—"  %}
              {{ phone|truncatechars:20 }}
            {% endwith %}
            </td>
            <td>
            {% with summary=datum.report.violation_summary|default:"—" %}
              {{ summary|truncatechars:120 }}
            {% endwith %}
            </td>
            <td>
            {% for protected_class in datum.report_protected_classes %}
                {% if not forloop.last %}
                  {{ protected_class|truncatechars:50 }},<br>
                {% else %}
                  {{ protected_class|truncatechars:50 }}
                {% endif %}
            {% endfor %}
            </td>
          </tr>
        {% endfor %}
      {% else %}
        <tr><td>No reports are available.</td><td></td><td></td><td></td><td></td></tr>
      {% endif %}
    </table>
  </div>
</div>
{% endblock %}
