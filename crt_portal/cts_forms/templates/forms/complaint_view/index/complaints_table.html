{% load sortable_table_heading %}

<table class="usa-table crt-table sort-table">
  <thead>
    <tr>
      {% render_sortable_heading 'Status' sort_state %}
      {% render_sortable_heading 'Routed' sort_state %}
      {% render_sortable_heading 'Submitted' sort_state %}
      {% render_sortable_heading 'Contact Name' sort_state %}
      {% render_sortable_heading 'Contact Details' sort_state %}
      {% render_sortable_heading 'Incident Location' sort_state %}
      {% render_sortable_heading 'Violation Summary' sort_state %}
      {% render_sortable_heading 'Class' sort_state %}
    </tr>
  </thead>
  {% if data_dict %}
    {% for datum in data_dict %}
      <tr class="tr-status-{{ datum.report.status }} tr--hover{% cycle ' stripe' '' %}">
        <td>
          <a class="td-link display-block" href="{{datum.url}}">
            <span class="status-tag status-{{ datum.report.status }}">
              {{ datum.report.status }}
            </span>
          </a>
        </td>
        <td><a class="td-link display-block" href="{{datum.url}}">{{ datum.report.assigned_section }}</a></td>
        <td><a class="td-link display-block" href="{{datum.url}}">{{ datum.report.create_date|date:"SHORT_DATE_FORMAT" }}</a></td>
        <td>
          <a class="td-link display-block" href="{{datum.url}}">
            {% with last=datum.report.contact_last_name|default:"—" %}
              {{ last|truncatechars:20 }}{% endwith %}, {% with first=datum.report.contact_first_name|default:"—" %}
              {{ first|truncatechars:20 }}
            {% endwith %}
          </a>
        </td>
        <td>
          <a class="td-link display-block" href="{{datum.url}}">
            {% with email=datum.report.contact_email|default:"—" %}
              {{ email|truncatechars:20 }}
            {% endwith %}
            <br>
            {% with phone=datum.report.contact_phone|default:"—"  %}
              {{ phone|truncatechars:20 }}
            {% endwith %}
          </a>
        </td>
        <td>
          <a class="td-link display-block" href="{{datum.url}}">
            <b>
              {{ datum.report.location_city_town }}, {{ datum.report.location_state }}
            </b>
          </a>
        </td>
        <td>
          <a class="td-link display-block" href="{{datum.url}}">
            {% with summary=datum.report.violation_summary|default:"—" %}
              {{ summary|truncatechars:120 }}
            {% endwith %}
          </a>
        </td>
        <td>
          <a class="td-link display-block" href="{{datum.url}}">
            {% for protected_class in datum.report_protected_classes %}
                {% if not forloop.last %}
                  {{ protected_class|truncatechars:50 }},<br>
                {% else %}
                  {{ protected_class|truncatechars:50 }}
                {% endif %}
            {% endfor %}
          </a>
        </td>
      </tr>
    {% endfor %}
  {% else %}
    <tr><td>No reports are available.<td><td></td></td></td><td></td><td></td><td></td><td></td></tr>
  {% endif %}
</table>
